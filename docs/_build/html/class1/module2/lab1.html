<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Deploy a new application</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Deploy a new application"/>
  <meta name="product" content="F5 + NGINX+ TTT Lab"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="None"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 + NGINX+ TTT Lab" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Deploy a new application &#8212; F5 + NGINX+ TTT Lab  documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5_agility_theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/21fb8a09c3.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Remove the application" href="lab2.html" />
    <link rel="prev" title="Module 2 - Trigger the IaC Demo" href="module2.html" />

  
    

  
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="dismiss">
      <button type="button" class="btn btn-info navbar-btn site-hidden">
        <i class="fa fa-align-justify"></i>
      </button>
    </div>
    <div id="sidebar" class="section-nav">
      
      <nav class="nav-sidebartoc">

        
         <h5>F5 + NGINX+ TTT Lab  </h5>
        
<div id="searchbox" role="search">
  <form class="search" action="../../search.html" method="get">
    <input type="text" class="search" name="q" placeholder=" Search..." />
    <button type="submit" class="btn btn-info navbar-btn"><i class="fa fa-search"></i></button>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        <hr>
        <h5>Current Page</h5>
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Deploy a new application</a><ul>
<li><a class="reference internal" href="#prepare-the-demo">Prepare the demo</a></li>
<li><a class="reference internal" href="#trigger-the-application-deployment">Trigger the application deployment</a></li>
</ul>
</li>
</ul>

         </span>
        <hr>
        <h5>Site Contents</h5>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../class1.html">Class 1 - demo IaC with CI/CD Tools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../module1/module1.html">Module 1 - Review the setup</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="module2.html">Module 2 - Trigger the IaC Demo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../class2/class2.html">Class 2 - Setup our first pipeline</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>

  
  <div class="main active" id="content">
    <article class="docs-container site-article-inner">
            <nav class="site-breadcrumb-nav site-nav">
          <ul class="site-breadcrumb-list">
            <li class="breadcrumb-item"><button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn site-hidden"><i class="fa fa-align-justify"></i></button>&#x20 <a href="/">Community Training Classes &amp; Labs</a> &gt; <a href="../../index.html">F5 + NGINX+ TTT Lab </a> &gt; Deploy a new application</li>
          </ul>
      </nav>
      
      

    
  <div class="section" id="deploy-a-new-application">
<h1>Deploy a new application<a class="headerlink" href="#deploy-a-new-application" title="Permalink to this headline">¶</a></h1>
<div class="section" id="prepare-the-demo">
<h2>Prepare the demo<a class="headerlink" href="#prepare-the-demo" title="Permalink to this headline">¶</a></h2>
<p>Here is the recommended worklow to do this demo.</p>
<p>Open different tabs in your browser:</p>
<ul>
<li><p class="first">Open 3 <em>GitLab</em> tabs:</p>
<blockquote>
<div><ul class="simple">
<li>one for the <strong>my-webapp-ci-cd-demo</strong> repo. <strong>don’t forget to go to the DEV branch</strong>
(login: TenantA,Password: Pa55w0rd)</li>
<li>one for the <strong>ADC-Services</strong> repo. <strong>don’t forget to go to the DEV branch</strong>.
(Login: TenantA,Password: Pa55w0rd)</li>
<li>one for the <strong>Security Policies</strong> repo. (login: root, Password: Pa55w0rd - go to <em>Projects</em> &gt;
<em>Explore Projects</em> &gt; <em>All</em>)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Open 2 <em>Jenkins</em> tabs: one for the <strong>my-webapp-ci-cd-demo-dev</strong> project and the other one
for the <strong>adc-services-dev</strong> project. <strong>don’t forget to go to the DEV branch</strong>.</p>
</li>
<li><p class="first">Open 1 tab on your BIG-IP to show its configuration (highlight that there is no <em>tenanta-dev</em> partition)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">if you use the <strong>UDF</strong> Blueprint, the BIG-IP login/password is admin/admin.</p>
</div>
</li>
<li><p class="first">Open 1 tab on your minishift deployment (<em>login</em>: dev, <em>password</em>: dev). Go in the <em>tenanta-dev</em> project</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">if you use the <strong>UDF</strong> Blueprint, we can’t access directly <em>Minishift</em> unfortunately.
Use the the <strong>Jumphost</strong> to access <em>Minishift</em></p>
</div>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>if you use F5 private cloud UDF, make sure minishift is up and running. If it’s not, check the
steps mentioned in the documentation of the blueprint/deployment. You likely need to run again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="n">ci</span><span class="o">-</span><span class="n">cd</span><span class="o">-</span><span class="n">env</span><span class="o">-</span><span class="n">setup</span><span class="o">/</span><span class="n">build</span><span class="o">-</span><span class="n">env</span><span class="o">.</span><span class="n">sh</span> <span class="n">minishift</span>
</pre></div>
</div>
<p>if it doesn’t work, you can try the following:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="n">ci</span><span class="o">-</span><span class="n">cd</span><span class="o">-</span><span class="n">env</span><span class="o">-</span><span class="n">setup</span>
<span class="n">minishift</span> <span class="n">stop</span>
<span class="n">minishift</span> <span class="n">delete</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">minishift</span>
<span class="o">./</span><span class="n">build</span><span class="o">-</span><span class="n">env</span><span class="o">.</span><span class="n">sh</span> <span class="n">minishift</span>
</pre></div>
</div>
</div>
<p>Make sure that:</p>
<ul class="simple">
<li>the <em>DELETE</em> file exists in the <strong>my-webapp-ci-cd-demo</strong> repo.</li>
<li>the <em>cluster-nicolas</em> folder in the <strong>ADC-Services</strong> repo should be empty except for an <em>OWNER</em> file.</li>
<li>Your BIG-IP configuration doesn’t have a <em>tenanta-dev</em> partition</li>
<li>You don’t have any App deployed in your minishift system in the tenanta-dev project.</li>
</ul>
<a class="reference internal image-reference" href="../../_images/img0021.png"><img alt="../../_images/img0021.png" class="align-center" src="../../_images/img0021.png" style="width: 336.0px; height: 316.2px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="../../_images/img0071.png"><img alt="../../_images/img0071.png" class="align-center" src="../../_images/img0071.png" style="width: 370.2px; height: 224.4px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="../../_images/img0081.png"><img alt="../../_images/img0081.png" class="align-center" src="../../_images/img0081.png" style="width: 735.0px; height: 256.2px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="../../_images/img0091.png"><img alt="../../_images/img0091.png" class="align-center" src="../../_images/img0091.png" style="width: 309.0px; height: 117.0px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Before triggering the application deployment, it may good good to give a brief overview of the setup:</p>
<ul class="simple">
<li>Highlights the different DevOps tools used: Gitlab, Jenkins, Consul, Minishift, BIG-IP, AS3</li>
<li>Explain what are the 3 <em>GitLab</em> repo and who owns each (TenantA is an application owner while Larry
is part of the SecOps team).</li>
<li>Describe how <em>WebHooks</em> will trigger our <em>Jenkins pipelines</em></li>
<li>Explain how the <em>my-webapp-ci-cd-demo-dev</em> <em>pipeline</em> will automatically manage the <strong>ADC-Services</strong> repo.</li>
<li>Explain that the <strong>ADC-Services</strong> repo becomes the “<em>Source of Truth</em>” of ADC services deployment (you can
talk about <em>Infrastructure as Code (IaC)</em></li>
</ul>
<p>Everything is detailed in module1.</p>
</div>
<div class="section" id="trigger-the-application-deployment">
<h2>Trigger the application deployment<a class="headerlink" href="#trigger-the-application-deployment" title="Permalink to this headline">¶</a></h2>
<p>In this demo, we use the <em>DELETE</em> file to leverage either the APP deployment, or its removal:</p>
<ul class="simple">
<li>if the <em>DELETE</em> file is added to the repo: we will remove the application and its ADC services</li>
<li>if the <em>DELETE</em> file is removed from the repo: we will deploy the application and its ADC services</li>
</ul>
<p>If everything is up and running as expected, you’ll only need to do the following to trigger the deployment
of the application:</p>
<ul class="simple">
<li>Remove the <em>DELETE</em> file from the <strong>my-webapp-ci-cd-demo</strong> repo.</li>
<li>if you use an editor instead of the GitLab UI, make sure to commit your changes to trigger the WebHook.</li>
</ul>
<p>Here is how to do it from the <em>GitLab</em> UI:</p>
<ul class="simple">
<li>Open the tab showing your <strong>my-webapp-ci-cd-demo</strong> repo and click on the <em>DELETE</em> file.
(make sure to be in the <em>dev</em> repo!)</li>
</ul>
<a class="reference internal image-reference" href="../../_images/img0041.png"><img alt="../../_images/img0041.png" class="align-center" src="../../_images/img0041.png" style="width: 351.59999999999997px; height: 315.0px;" /></a>
<ul class="simple">
<li>Click on the red <em>DELETE</em> button on the right</li>
</ul>
<a class="reference internal image-reference" href="../../_images/img0051.png"><img alt="../../_images/img0051.png" class="align-center" src="../../_images/img0051.png" style="width: 759.0px; height: 180.0px;" /></a>
<ul class="simple">
<li>Confirm that you want to delete the file by clicking on the <em>Delete File</em> button.</li>
</ul>
<a class="reference internal image-reference" href="../../_images/img0061.png"><img alt="../../_images/img0061.png" class="align-center" src="../../_images/img0061.png" style="width: 298.2px; height: 181.79999999999998px;" /></a>
<p>As soon as you’ll do it from the GUI of <em>GitLab</em>, it will be committed.</p>
<a class="reference internal image-reference" href="../../_images/img0101.png"><img alt="../../_images/img0101.png" class="align-center" src="../../_images/img0101.png" style="width: 425.4px; height: 328.2px;" /></a>
<p>At this moment, switch to the <em>Jenkins</em> tab showing the pipeline called <strong>my-webapp-ci-cd-demo-dev</strong>.
You will see a new <em>build</em> being triggered after a few seconds.</p>
<a class="reference internal image-reference" href="../../_images/img0111.png"><img alt="../../_images/img0111.png" class="align-center" src="../../_images/img0111.png" style="width: 608.4px; height: 424.8px;" /></a>
<p>Here you can see the different steps being processed in this pipeline:</p>
<ul class="simple">
<li><em>build app</em>: the application gets deployed in Openshift</li>
<li><em>test app</em>: we run the different tests against the application and make sure we get the right response code
(defined in the folder <strong>tests</strong> in the repo <strong>my-webapp-ci-cd-demo</strong>)</li>
<li><em>build ADC services definition</em>: we extract the IP of the application to add it to the service definition
provided in the <strong>my-webapp-ci-cd-demo</strong> repo.</li>
<li><em>Test ADC Service definition</em>: We test this service definition against the targetted BIG-IP cluster to
ensure it is properly defined without errors</li>
<li><em>Push ADC Service definition</em>: We update the repo <strong>ADC-Services</strong> in our <em>Gitlab</em> repo to add this application
in the right cluster. Here it is in the <strong>cluster-nicolas</strong> directory</li>
</ul>
<p>If everything goes as expected, you should see the whole line of the build being green:</p>
<a class="reference internal image-reference" href="../../_images/img0121.png"><img alt="../../_images/img0121.png" class="align-center" src="../../_images/img0121.png" style="width: 779.4px; height: 345.0px;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>if you have a step failing, the whole build will stop. To troubleshoot it, don’t hesitate to click on the build
number and then <em>Console Output</em></p>
<a class="reference internal image-reference" href="../../_images/img0141.png"><img alt="../../_images/img0141.png" class="align-center" src="../../_images/img0141.png" style="width: 209.4px; height: 112.2px;" /></a>
<a class="reference internal image-reference" href="../../_images/img0151.png"><img alt="../../_images/img0151.png" class="align-center" src="../../_images/img0151.png" style="width: 207.0px; height: 279.0px;" /></a>
<p class="last">Here you’ll see the whole pipeline being executed with all the different outputs. Check for any relevant error messages</p>
</div>
<p>We can check that the application has been deployed successfully, go to your minishift tab and you should see
a new application:</p>
<a class="reference internal image-reference" href="../../_images/img0161.png"><img alt="../../_images/img0161.png" class="align-center" src="../../_images/img0161.png" style="width: 852.6px; height: 373.2px;" /></a>
<p>You can click on the route link to ensure the application works as expected.</p>
<a class="reference internal image-reference" href="../../_images/img0171.png"><img alt="../../_images/img0171.png" class="align-center" src="../../_images/img0171.png" style="width: 854.4px; height: 377.4px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="../../_images/img0181.png"><img alt="../../_images/img0181.png" class="align-center" src="../../_images/img0181.png" style="width: 645.0px; height: 307.2px;" /></a>
<p>The last step of the build updated the <strong>ADC-Services</strong> repo to add our new application services.</p>
<p>Go to the tab opened on <em>GitLab</em> and on your <strong>ADC-Services</strong> repo (make sure to be in the <strong>dev</strong> branch!).</p>
<p>Click on the folder <strong>cluster-nicolas</strong>. you should see a new directory called <strong>my-webapp-ci-cd-demo</strong>.
This was pushed by our pipeline processed by <em>Jenkins</em></p>
<a class="reference internal image-reference" href="../../_images/img0191.png"><img alt="../../_images/img0191.png" class="align-center" src="../../_images/img0191.png" style="width: 582.6px; height: 294.59999999999997px;" /></a>
<p>Click on this newly provisioned folder <strong>my-webapp-ci-cd-demo</strong></p>
<a class="reference internal image-reference" href="../../_images/img0191.png"><img alt="../../_images/img0191.png" class="align-center" src="../../_images/img0191.png" style="width: 582.6px; height: 294.59999999999997px;" /></a>
<p>You’ll see two files:</p>
<ul class="simple">
<li>service-definition: it contains the service definition that was provided by the app owner in the other repo.
This service definition was updated with the relevant pool member delivering the app (minishift IP)</li>
<li>tests.json: we also copied the <em>tests</em> file from the application repo since we want to make sure the same tests
will behave in an identical manner through the ADC</li>
</ul>
<p>We can review the <em>commit</em> that was done by the <em>CI server</em> <em>Jenkins</em> by clicking on the <em>commit</em> menu</p>
<a class="reference internal image-reference" href="../../_images/img0211.png"><img alt="../../_images/img0211.png" class="align-center" src="../../_images/img0211.png" style="width: 991.1999999999999px; height: 173.4px;" /></a>
<p>Here we can see that the commit message provide some useful information that will be used later: the application name and
which BIG-IP cluster has been targetted for this new ADC service.</p>
<p>Since we updated the <strong>ADC-Services</strong> repo, it also triggered a <em>WebHook</em> to the <em>CI Server</em> <em>Jenkins</em>. Go to your
other tab on <em>Jenkins</em> related to the project called <strong>adc-services-dev</strong>. You will see that a <em>build</em> has also
been triggered:</p>
<a class="reference internal image-reference" href="../../_images/img0131.png"><img alt="../../_images/img0131.png" class="align-center" src="../../_images/img0131.png" style="width: 948.5999999999999px; height: 416.4px;" /></a>
<p>Here are the different steps of this build:</p>
<ul class="simple">
<li><em>Build AS3 Declaration</em>: We identify which cluster has been updated based on the commit log that we reviewed previously.
We will parse all the application folders in the relevant BIG-IP cluster to create a single AS3 declaration for the whole
tenant. The AS3 tenant name will be based on the <em>Gitlab</em> tenant (ie TenantA) and the related branch (<em>dev</em>)</li>
<li><em>Test AS3 Declaration</em>: we do a <em>dry run</em> of the AS3 declaration to make sure no errors, mistakes are identified</li>
<li><em>Deploy AS3 Declaration</em>: if the previous <em>dry run</em> is successful, we <em>deploy</em> this time the AS3 declaration</li>
<li><em>Test ADC and App</em>: We run the different tests against the updated BIG-IP to ensure all the tests still behave as expected</li>
</ul>
<p>If everything is processed properly, the whole build line should be green as you may see on the picture above.</p>
<p>You can go to your BIG-IP tab, to see if a new application service has been deployed:</p>
<ul class="simple">
<li>Select the partition <em>tenanta-dev</em></li>
<li>check the virtual server and its description. The description of the VS will be the name of the application to which we appended the branch name</li>
</ul>
<a class="reference internal image-reference" href="../../_images/img0221.png"><img alt="../../_images/img0221.png" class="align-center" src="../../_images/img0221.png" style="width: 990.0px; height: 196.2px;" /></a>
<p>Check the settings of the Virtual Server to show that a WAF policy has been assigned to it.</p>
<p>You can try to reach the application through the BIG-IP now. Be aware that you’ll need to either:</p>
<ul class="simple">
<li>update your hosts file to add the minishift/openshift FQDN of the app and tie it to your virtual server IP</li>
<li>use the IP but you need to enforce a <em>Host header</em> with the right fqdn</li>
</ul>
<p>This is because Openshift/Minishift route based on the FQDN of the app.</p>
<a class="reference internal image-reference" href="../../_images/img0171.png"><img alt="../../_images/img0171.png" class="align-center" src="../../_images/img0171.png" style="width: 854.4px; height: 377.4px;" /></a>
<p>In this example, the FQDN to use is : my-frontend-route-tenanta-dev.192.168.143.212.nip.io</p>
</div>
</div>


    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="module2.html" title="Module 2 - Trigger the IaC Demo" accesskey="p" class="btn btn-primary pull-left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="lab2.html" title="Remove the application" accesskey="n" class="btn btn-primary pull-right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  </body>
</html>